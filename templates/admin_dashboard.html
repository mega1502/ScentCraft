<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ScentCraft | Command Grid</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Montserrat:wght@300;400;600;700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        /* --- THEME CONFIG --- */
        :root {
            --bg-body: #080808;
            --bg-card: #121212;
            --border: rgba(255, 255, 255, 0.08);
            --gold: #D4AF37;
            --blue: #00f0ff;
            --red: #ff2a6d;
            --green: #05ffa1;
        }

        body { 
            background-color: var(--bg-body); 
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(212, 175, 55, 0.05), transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(0, 240, 255, 0.05), transparent 25%);
            color: #fff; font-family: 'Montserrat', sans-serif; 
            padding: 40px; min-height: 100vh;
        }

        .container { max-width: 1600px; margin: 0 auto; }

        /* --- HEADER --- */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 50px; padding-bottom: 20px; border-bottom: 1px solid var(--border);
        }
        .brand h1 { 
            font-family: 'Playfair Display'; font-size: 2.5rem; margin: 0; 
            background: linear-gradient(to right, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .brand span { color: var(--gold); -webkit-text-fill-color: var(--gold); }
        .user-badge {
            background: #1a1a1a; padding: 8px 20px; border-radius: 50px; border: 1px solid var(--border);
            display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: #aaa;
        }
        .btn-exit { color: #fff; text-decoration: none; margin-left: 15px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-exit:hover { color: var(--red); }

        /* --- STATS HUD (Top Bar) --- */
        .hud-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; margin-bottom: 60px; 
        }
        .hud-card { 
            background: var(--bg-card); border: 1px solid var(--border); padding: 25px; 
            border-radius: 16px; position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
        }
        .hud-card::before { content:''; position: absolute; top:0; left:0; width: 4px; height: 100%; background: #333; }
        .hud-card.gold::before { background: var(--gold); box-shadow: 2px 0 15px var(--gold); }
        .hud-card.blue::before { background: var(--blue); box-shadow: 2px 0 15px var(--blue); }
        .hud-card.mixed::before { background: linear-gradient(to bottom, var(--blue), var(--gold)); }

        .hud-val { font-family: 'Rajdhani'; font-size: 2.2rem; font-weight: 700; color: #fff; line-height: 1; }
        .hud-lbl { color: #666; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; margin-top: 5px; }
        
        /* Split Stats (Lab vs Shop) */
        .split-stats { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 10px; }
        .stat-part { text-align: center; flex: 1; }
        .stat-part:first-child { border-right: 1px solid rgba(255,255,255,0.1); }
        
        .mini-val { font-family: 'Rajdhani'; font-size: 1.8rem; font-weight: 700; line-height: 1; }
        .mini-lbl { font-size: 0.65rem; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-top: 2px; }

        .analysis-bar { width: 100%; height: 4px; background: #222; border-radius: 10px; display: flex; overflow: hidden; }
        .seg-shop { height: 100%; background: var(--blue); }
        .seg-lab { height: 100%; background: var(--gold); }

        /* --- ORDERS GRID --- */
        .grid-header { font-family: 'Rajdhani'; font-size: 1.5rem; margin-bottom: 20px; color: #fff; text-transform: uppercase; letter-spacing: 2px; display: flex; align-items: center; gap: 10px; }
        .grid-header .dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; box-shadow: 0 0 10px var(--green); }

        .orders-container {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); 
            gap: 30px;
        }

        /* --- THE CARD --- */
        .order-card {
            background: linear-gradient(145deg, #151515, #0f0f0f);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            transition: all 0.3s ease;
            display: flex; flex-direction: column;
        }
        .order-card:hover {
            transform: translateY(-7px);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        /* Card Top */
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px; }
        .o-id { font-family: 'Rajdhani'; font-size: 1.4rem; font-weight: 700; color: #444; }
        .o-status { 
            padding: 5px 12px; border-radius: 30px; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
        }
        .st-proc { background: rgba(255, 193, 7, 0.1); color: #ffc107; border: 1px solid rgba(255, 193, 7, 0.3); }
        .st-ship { background: rgba(0, 240, 255, 0.1); color: var(--blue); border: 1px solid rgba(0, 240, 255, 0.3); }
        .st-done { background: rgba(5, 255, 161, 0.1); color: var(--green); border: 1px solid rgba(5, 255, 161, 0.3); }
        .st-dead { background: rgba(255, 42, 109, 0.1); color: var(--red); border: 1px solid rgba(255, 42, 109, 0.3); }

        /* User Info */
        .card-user { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .u-avatar { 
            width: 45px; height: 45px; border-radius: 50%; background: #1a1a1a; color: var(--gold);
            display: flex; align-items: center; justify-content: center; font-family: 'Playfair Display'; font-weight: bold; border: 1px solid #333;
        }
        .u-info h4 { margin: 0; font-size: 1rem; color: #eee; }
        .u-info p { margin: 2px 0 0; font-size: 0.75rem; color: #777; }

        /* Items List */
        .card-items { flex-grow: 1; margin-bottom: 20px; }
        .c-item { 
            background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; margin-bottom: 8px; 
            border-left: 2px solid #333; display: flex; flex-direction: column;
        }
        .c-name { font-size: 0.85rem; font-weight: 600; color: #ddd; display: flex; justify-content: space-between; }
        .c-recipe { 
            margin-top: 6px; font-size: 0.7rem; color: var(--gold); font-family: 'Rajdhani'; 
            background: rgba(212, 175, 55, 0.05); padding: 4px; border-radius: 4px; display: flex; align-items: center; gap: 5px;
        }

        /* Card Bottom */
        .card-actions { 
            display: flex; justify-content: space-between; align-items: center; 
            padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); 
        }
        .o-total { font-family: 'Rajdhani'; font-size: 1.6rem; font-weight: 700; color: #fff; }
        .o-total span { font-size: 0.8rem; color: #666; font-weight: 400; }

        .btn-grp { display: flex; gap: 10px; }
        .act-btn { 
            width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center;
            border: 1px solid transparent; background: #222; color: #888; transition: 0.3s; text-decoration: none;
        }
        .act-ship:hover { background: var(--blue); color: #000; box-shadow: 0 0 15px var(--blue); }
        .act-cancel:hover { background: var(--red); color: #fff; box-shadow: 0 0 15px var(--red); }
        .act-done:hover { background: var(--green); color: #000; box-shadow: 0 0 15px var(--green); }

    </style>
</head>
<body>

<div class="container">
    
    <div class="header">
        <div class="brand">
            <h1>Scent<span>Craft</span></h1>
        </div>
        <div class="user-badge">
            <span class="material-symbols-outlined" style="font-size:1.1rem;">admin_panel_settings</span>
            Command Center
            <a href="{{ url_for('home') }}" class="btn-exit">EXIT</a>
        </div>
    </div>

    <div class="hud-grid">
        <div class="hud-card gold">
            <div class="hud-val">{{ revenue }}</div>
            <div class="hud-lbl">Total Revenue (EGP)</div>
        </div>
        
        <div class="hud-card blue">
            <div class="hud-val">{{ pending }}</div>
            <div class="hud-lbl">Orders Pending</div>
        </div>
        
        <div class="hud-card mixed">
            <div class="split-stats">
                <div class="stat-part">
                    <div class="mini-val" style="color: var(--blue);">{{ shop_sales }}</div>
                    <div class="mini-lbl">Shop Sales</div>
                </div>
                <div class="stat-part">
                    <div class="mini-val" style="color: var(--gold);">{{ lab_sales }}</div>
                    <div class="mini-lbl">Lab Creations</div>
                </div>
            </div>
            <div class="analysis-bar">
                <div class="seg-shop" style="width: {{ shop_pct }}%;"></div>
                <div class="seg-lab" style="width: {{ lab_pct }}%;"></div>
            </div>
        </div>
    </div>

    <div class="grid-header">
        <span class="dot"></span> Live Orders Feed
    </div>

    <div class="orders-container">
        {% for order in orders %}
        <div class="order-card">
            
            <div class="card-top">
                <div class="o-id">#{{ order.id }}</div>
                {% if order.status == 'Processing' %}
                    <div class="o-status st-proc">Processing</div>
                {% elif order.status == 'Shipped' %}
                    <div class="o-status st-ship">Shipped</div>
                {% elif order.status == 'Delivered' %}
                    <div class="o-status st-done">Delivered</div>
                {% else %}
                    <div class="o-status st-dead">Cancelled</div>
                {% endif %}
            </div>

            <div class="card-user">
                <div class="u-avatar">{{ order.user.name[0] | upper }}</div>
                <div class="u-info">
                    <h4>{{ order.user.name }}</h4>
                    <p>{{ order.user.phone }}</p>
                    <p style="color:#555; font-size:0.7rem;">{{ order.user.address }}</p>
                </div>
            </div>

            <div class="card-items">
                {% for item in order.items %}
                <div class="c-item">
                    <div class="c-name">
                        <span>{{ item.product_name }}</span>
                        <span style="color:#666;">x{{ item.quantity }}</span>
                    </div>
                    {% if item.details and item.details != 'Standard Collection' and item.details != '-' %}
                        <div class="c-recipe">
                            <span class="material-symbols-outlined" style="font-size:0.8rem;">science</span> 
                            {{ item.details }}
                        </div>
                    {% else %}
                        <div class="c-recipe" style="color: #555;">
                            <span class="material-symbols-outlined" style="font-size:0.8rem;">shopping_bag</span>
                            Standard Collection
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="card-actions">
                <div class="o-total">{{ order.total }}<small>EGP</small></div>
                
                <div class="btn-grp">
                    {% if order.status == 'Processing' %}
                        <a href="{{ url_for('change_order_status', order_id=order.id, new_status='Shipped') }}" class="act-btn act-ship" title="Ship Order">
                            <span class="material-symbols-outlined">rocket_launch</span>
                        </a>
                        <a href="{{ url_for('change_order_status', order_id=order.id, new_status='Cancelled') }}" class="act-btn act-cancel" onclick="return confirm('Delete Order?')" title="Delete">
                            <span class="material-symbols-outlined">delete</span>
                        </a>
                    {% elif order.status == 'Shipped' %}
                        <a href="{{ url_for('change_order_status', order_id=order.id, new_status='Delivered') }}" class="act-btn act-done" title="Complete">
                            <span class="material-symbols-outlined">check_circle</span>
                        </a>
                    {% endif %}
                </div>
            </div>

        </div>
        {% else %}
        <div style="grid-column: 1/-1; text-align: center; padding: 100px; color: #333;">
            <span class="material-symbols-outlined" style="font-size: 4rem;">inbox</span>
            <br>No orders in the system.
        </div>
        {% endfor %}
    </div>

</div>

</body>
</html>